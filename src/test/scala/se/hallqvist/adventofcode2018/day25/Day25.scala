package se.hallqvist.adventofcode2018.day25

import org.scalatest._

/*
--- Day 25: Four-Dimensional Adventure ---
The reindeer's symptoms are getting worse, and neither you nor the white-bearded man have a solution. At least the reindeer has a warm place to rest: a small bed near where you're sitting.

As you reach down, the reindeer looks up at you, accidentally bumping a button on your wrist-mounted device with its nose in the process - a button labeled "help".

"Hello, and welcome to the Time Travel Support Hotline! If you are lost in time and space, press 1. If you are trapped in a time paradox, press 2. If you need help caring for a sick reindeer, press 3. If you--"

Beep.

A few seconds later, you hear a new voice. "Hello; please state the nature of your reindeer." You try to describe the situation.

"Just a moment, I think I can remotely run a diagnostic scan." A beam of light projects from the device and sweeps over the reindeer a few times.

"Okay, it looks like your reindeer is very low on magical energy; it should fully recover if we can fix that. Let me check your timeline for a source.... Got one. There's actually a powerful source of magical energy about 1000 years forward from you, and at roughly your position, too! It looks like... hot chocolate? Anyway, you should be able to travel there to pick some up; just don't forget a mug! Is there anything else I can help you with today?"

You explain that your device isn't capable of going forward in time. "I... see. That's tricky. Well, according to this information, your device should have the necessary hardware to open a small portal and send some hot chocolate back to you. You'll need a list of fixed points in spacetime; I'm transmitting it to you now."

"You just need to align your device to the constellations of fixed points so that it can lock on to the destination and open the portal. Let me look up how much hot chocolate that breed of reindeer needs."

"It says here that your particular reindeer is-- this can't be right, it says there's only one like that in the universe! But THAT means that you're--" You disconnect the call.

The list of fixed points in spacetime (your puzzle input) is a set of four-dimensional coordinates. To align your device, acquire the hot chocolate, and save the reindeer, you just need to find the number of constellations of points in the list.

Two points are in the same constellation if their manhattan distance apart is no more than 3 or if they can form a chain of points, each a manhattan distance no more than 3 from the last, between the two of them. (That is, if a point is close enough to a constellation, it "joins" that constellation.) For example:

 0,0,0,0
 3,0,0,0
 0,3,0,0
 0,0,3,0
 0,0,0,3
 0,0,0,6
 9,0,0,0
12,0,0,0
In the above list, the first six points form a single constellation: 0,0,0,0 is exactly distance 3 from the next four, and the point at 0,0,0,6 is connected to the others by being 3 away from 0,0,0,3, which is already in the constellation. The bottom two points, 9,0,0,0 and 12,0,0,0 are in a separate constellation because no point is close enough to connect them to the first constellation. So, in the above list, the number of constellations is 2. (If a point at 6,0,0,0 were present, it would connect 3,0,0,0 and 9,0,0,0, merging all of the points into a single giant constellation instead.)

In this example, the number of constellations is 4:

-1,2,2,0
0,0,2,-2
0,0,0,-2
-1,2,0,0
-2,-2,-2,2
3,0,2,-1
-1,3,2,2
-1,0,-1,0
0,2,1,-2
3,0,0,0
In this one, it's 3:

1,-1,0,1
2,0,-1,0
3,2,-1,0
0,0,3,1
0,0,-1,-1
2,3,-2,0
-2,2,0,0
2,-2,0,-1
1,-1,0,-1
3,2,0,2
Finally, in this one, it's 8:

1,-1,-1,-2
-2,-2,0,1
0,2,1,3
-2,3,-2,1
0,2,3,-2
-1,-1,1,-2
0,-2,-1,0
-2,2,3,-1
1,2,2,0
-1,-2,0,-2
The portly man nervously strokes his white beard. It's time to get that hot chocolate.

How many constellations are formed by the fixed points in spacetime?

--- Part Two ---
A small glowing portal opens above the mug you prepared and just enough hot chocolate streams in to fill it. You suspect the reindeer has never encountered hot chocolate before, but seems to enjoy it anyway. You hope it works.

It's time to start worrying about that integer underflow in time itself you set up a few days ago. You check the status of the device: "Insufficient chronal energy for activation. Energy required: 50 stars."

The reindeer bumps the device with its nose.

"Energy required: 49 stars."
*/

class Day25 extends FlatSpec {
  val input = """4,1,0,5
                |-8,-3,-5,2
                |-8,-8,-2,-4
                |-8,1,7,2
                |-3,1,5,4
                |0,8,8,-8
                |3,-5,-4,-6
                |7,-3,7,-6
                |4,3,1,-3
                |2,-3,-6,-3
                |-2,7,-5,3
                |0,-4,2,0
                |-4,5,0,-8
                |2,-3,1,6
                |-3,-2,0,1
                |5,-3,1,2
                |5,2,-2,6
                |-7,3,-1,-5
                |-5,0,7,-1
                |-4,2,4,5
                |6,2,3,0
                |-2,1,2,-1
                |7,-2,-8,-3
                |-6,7,2,1
                |3,6,-3,4
                |-2,2,6,3
                |8,2,5,5
                |-8,-6,7,-7
                |7,-5,-2,3
                |6,4,-7,-5
                |0,0,7,-3
                |-5,-2,3,-4
                |6,1,-4,4
                |-1,1,-1,-8
                |4,3,-4,3
                |6,6,5,5
                |8,-2,2,-4
                |-8,6,-2,5
                |-4,6,-4,8
                |3,-2,0,-3
                |5,3,-5,-2
                |7,3,4,0
                |-2,1,4,-2
                |-4,-3,5,-2
                |2,3,-1,-2
                |-3,2,0,3
                |-3,2,-5,-7
                |-7,0,5,4
                |-8,-8,2,4
                |-4,0,-6,0
                |1,6,-4,5
                |7,5,-2,8
                |0,4,-4,1
                |-1,-7,-8,6
                |1,7,7,-4
                |-2,3,-6,7
                |-2,6,4,5
                |-3,-1,-6,-1
                |5,-8,1,5
                |-1,-7,6,0
                |-7,2,5,-8
                |-1,8,-1,-1
                |5,0,-2,0
                |-1,-2,8,6
                |-4,3,2,4
                |-8,0,3,2
                |7,7,-4,6
                |4,7,-3,1
                |5,-7,-3,0
                |5,2,-3,8
                |1,-3,-7,-3
                |7,-5,2,7
                |3,5,0,5
                |3,1,-7,5
                |-3,-2,7,-6
                |1,0,8,-3
                |-2,3,-1,6
                |6,6,2,-5
                |-8,-5,-5,7
                |8,5,-6,6
                |-2,6,-3,0
                |6,1,-6,-6
                |-5,7,-8,1
                |-6,-5,0,2
                |-3,0,1,-1
                |1,5,7,4
                |7,1,1,1
                |7,-7,7,0
                |5,8,0,7
                |3,4,-2,-7
                |-3,-8,8,0
                |0,6,3,2
                |7,-1,-5,-1
                |2,-3,-1,3
                |6,2,3,-7
                |-3,-5,4,-3
                |-6,-5,-7,4
                |3,-3,-4,4
                |3,7,-1,4
                |6,0,-4,3
                |3,-5,-2,-4
                |-2,3,6,0
                |2,5,5,8
                |4,0,3,-5
                |-2,1,3,-4
                |-6,2,8,6
                |4,-7,6,-6
                |1,0,-7,8
                |-2,-7,-6,3
                |4,-1,6,4
                |2,-2,0,-8
                |8,7,0,7
                |-5,6,-8,7
                |-2,2,2,3
                |3,4,6,5
                |-6,0,0,-4
                |-3,8,0,8
                |-7,0,-3,-5
                |-8,8,7,1
                |7,0,6,4
                |3,4,0,-8
                |0,0,7,-8
                |-6,1,-1,-5
                |-1,0,4,-8
                |-8,-1,-8,6
                |7,3,6,0
                |7,2,4,0
                |5,-7,0,3
                |0,3,0,-8
                |-6,-7,-8,1
                |6,0,-5,-4
                |8,1,3,6
                |-2,5,-7,2
                |2,3,0,0
                |-8,-2,0,-7
                |0,0,1,-1
                |0,-8,-3,4
                |0,-7,-4,-7
                |-6,2,-4,4
                |-3,-6,-8,-8
                |7,-3,-4,5
                |-6,0,-5,-2
                |2,-8,-3,-6
                |2,0,1,-4
                |2,-8,1,0
                |-1,-5,-8,-4
                |5,2,5,-3
                |-8,-1,-2,-5
                |7,0,1,-6
                |0,-1,5,-5
                |-6,4,8,-1
                |-7,5,3,1
                |-2,-5,5,8
                |6,-2,8,7
                |-4,-5,8,-4
                |8,-8,1,6
                |-6,4,2,-6
                |0,-6,3,8
                |-7,0,3,-5
                |-3,-7,4,0
                |8,-4,-8,6
                |-1,-5,6,-4
                |7,-5,-8,6
                |2,-6,1,2
                |-7,-8,7,3
                |-7,1,-5,0
                |6,4,4,-5
                |5,1,-1,-4
                |2,4,5,-1
                |-2,-6,-7,0
                |3,5,1,-5
                |8,-8,-5,6
                |-5,-4,6,5
                |0,0,6,-2
                |4,0,-6,-1
                |3,8,-5,-2
                |-2,8,1,8
                |6,3,2,-4
                |-3,-4,6,-8
                |4,0,-6,2
                |8,7,2,1
                |-1,3,6,-5
                |-1,7,-5,-2
                |0,6,-2,1
                |2,4,6,7
                |-5,-4,4,-1
                |5,7,-2,3
                |4,8,0,-4
                |6,-6,7,-7
                |-5,-7,3,-2
                |7,-3,7,0
                |-4,2,-4,-5
                |3,0,0,8
                |8,-8,-1,5
                |0,0,2,8
                |4,0,-3,-3
                |-4,6,8,0
                |-6,6,-2,3
                |0,0,-3,5
                |-6,-8,4,-3
                |-3,5,-5,7
                |2,2,6,4
                |-5,3,6,7
                |-1,-7,7,2
                |-7,-1,-8,6
                |7,5,2,-2
                |4,5,5,6
                |0,3,5,6
                |-3,-8,3,-1
                |-2,3,-5,0
                |1,1,-3,0
                |6,-5,1,1
                |0,-2,-3,3
                |-6,-7,-1,-5
                |3,-8,-3,-1
                |-5,-4,4,-7
                |0,6,-4,-1
                |3,-5,0,-6
                |5,0,-6,-4
                |0,-5,-4,-8
                |-2,5,1,-6
                |-5,-2,-8,-2
                |0,-2,-6,-6
                |-5,-5,5,0
                |7,6,-4,1
                |8,4,0,7
                |-1,6,6,-5
                |0,8,-7,6
                |-1,1,3,0
                |0,0,-1,3
                |8,0,-3,0
                |0,-5,-2,1
                |-3,7,-1,2
                |2,3,-8,-7
                |-8,-1,-4,-3
                |8,7,-2,3
                |6,-5,0,-6
                |-7,8,1,0
                |-5,-7,-6,-1
                |0,-4,0,-8
                |-3,8,0,2
                |0,-1,4,-3
                |-6,-1,2,1
                |0,-4,-4,-2
                |0,-1,-3,2
                |-2,-3,-2,2
                |-5,3,-8,5
                |-4,2,5,-4
                |1,5,4,3
                |-8,4,-1,-4
                |-6,-4,-7,0
                |-7,5,-7,1
                |1,2,5,0
                |7,0,1,-8
                |-7,7,4,-8
                |8,4,7,-4
                |4,5,0,4
                |0,-6,7,4
                |7,-8,2,7
                |7,-1,-1,-8
                |7,3,4,-6
                |-4,0,1,-2
                |5,5,0,-1
                |8,6,8,-8
                |-2,-4,4,2
                |-7,4,2,4
                |-1,3,-6,-5
                |0,4,0,0
                |-5,4,8,0
                |6,6,8,-8
                |5,-8,6,0
                |-8,6,3,-7
                |-1,7,0,5
                |-2,-3,7,-3
                |0,-3,7,2
                |2,-3,-4,-6
                |7,3,-7,-5
                |7,5,7,-1
                |-4,7,-1,8
                |3,-3,5,0
                |-4,-4,2,-2
                |1,1,-4,0
                |3,-1,6,0
                |5,-5,5,-6
                |5,-8,-1,5
                |-2,-5,3,-7
                |1,-1,0,-4
                |7,2,-8,6
                |7,2,-6,-5
                |7,-2,-4,-6
                |8,-3,3,1
                |5,4,1,-6
                |0,-8,-2,0
                |0,-6,4,2
                |8,1,4,3
                |-4,7,0,0
                |-3,1,-3,-4
                |2,-1,-6,0
                |-1,8,-4,-6
                |-3,8,0,1
                |7,0,4,-2
                |-2,2,-8,-4
                |8,2,3,2
                |-1,-7,-6,7
                |4,-5,0,5
                |-3,4,8,-3
                |6,0,-3,-3
                |-5,5,-6,5
                |3,8,-4,5
                |7,0,7,-7
                |-3,-3,-2,7
                |0,-2,2,-6
                |4,-1,7,-5
                |8,-8,0,-6
                |5,-6,-4,0
                |-4,8,5,-2
                |2,-8,-3,3
                |2,0,1,-8
                |-1,-3,-8,-1
                |-3,-5,-2,0
                |2,-5,1,-5
                |8,3,0,-4
                |-2,-8,0,-3
                |-8,3,-7,-4
                |6,-6,-1,2
                |-1,5,-2,1
                |-1,2,-3,-2
                |-5,-6,7,-4
                |4,-8,3,5
                |0,-1,0,-1
                |-6,5,8,1
                |2,7,-3,0
                |-6,6,-5,-5
                |6,8,-2,6
                |4,2,2,4
                |-3,0,-8,0
                |0,-3,-4,-5
                |4,-1,0,0
                |1,5,6,2
                |-4,-7,7,0
                |5,1,5,-5
                |4,0,0,-2
                |0,1,-2,-1
                |5,-7,-5,7
                |3,2,3,4
                |0,0,-3,8
                |5,2,-7,6
                |2,5,-3,6
                |-7,1,2,4
                |1,4,-3,0
                |-7,0,3,-4
                |-5,1,-1,-4
                |2,-8,-7,3
                |2,3,-6,2
                |-5,5,-6,-3
                |0,5,8,2
                |5,-4,-1,2
                |-3,2,5,-6
                |4,5,0,-3
                |-6,-5,6,0
                |0,-7,-2,-3
                |-6,5,-6,0
                |-7,3,3,-1
                |6,3,-1,-2
                |2,0,0,4
                |0,-1,8,6
                |-4,1,-4,-1
                |7,-3,7,-1
                |0,6,3,0
                |-8,-4,-1,-4
                |-1,-5,0,-8
                |0,-5,-3,0
                |0,-2,-2,6
                |5,-7,5,-7
                |5,-4,-6,-5
                |0,-5,0,3
                |7,-2,-1,8
                |0,-1,-8,7
                |-2,5,2,6
                |-4,-4,-3,0
                |-2,2,5,1
                |2,-1,-7,7
                |-2,-4,-6,-3
                |4,0,-1,-4
                |-8,8,-5,5
                |5,-2,3,6
                |6,-1,7,-7
                |5,-5,6,-4
                |7,7,-6,-6
                |-5,8,-2,4
                |1,6,-2,7
                |0,2,3,2
                |-5,-8,-5,-2
                |5,-3,-7,-5
                |4,5,6,4
                |-4,-2,-1,-4
                |4,-6,-2,-7
                |-2,2,-1,-8
                |-5,2,-4,5
                |7,-6,-1,7
                |0,3,-2,3
                |-7,-3,8,8
                |-7,6,-3,1
                |-8,0,-2,1
                |0,5,-6,0
                |1,-6,-2,7
                |0,-3,4,0
                |8,4,5,-8
                |2,-7,-6,4
                |6,4,7,-5
                |-5,6,-4,2
                |0,-5,5,2
                |-7,-8,2,4
                |7,7,-5,6
                |-7,5,2,5
                |-6,-4,4,0
                |0,-4,6,-2
                |-4,4,7,6
                |1,-3,-4,-6
                |0,8,-8,-5
                |0,2,1,0
                |-5,-6,0,4
                |-7,7,7,-7
                |-8,3,6,-1
                |7,3,-7,-2
                |0,-8,2,-6
                |8,3,-5,-1
                |8,7,-6,-7
                |-5,-3,6,7
                |-6,-6,-7,-6
                |3,-2,-8,-8
                |-6,3,8,5
                |4,3,8,6
                |-7,6,-3,7
                |3,7,5,5
                |0,3,-6,4
                |-6,-3,-8,2
                |2,-7,6,0
                |-1,3,-1,0
                |-3,-4,4,8
                |-8,-1,-5,4
                |-4,-4,0,8
                |0,7,5,4
                |2,0,-4,2
                |6,0,-5,5
                |-8,0,-5,4
                |6,-2,7,1
                |5,-5,-3,8
                |1,-5,0,-4
                |-5,5,0,5
                |-5,-3,8,-8
                |-5,-2,5,6
                |0,-6,-4,-4
                |0,-1,1,-5
                |0,0,6,-4
                |4,-3,5,-4
                |8,3,0,-6
                |0,6,8,7
                |4,2,-5,-5
                |0,-1,0,-8
                |-1,6,-2,-5
                |-1,-5,-5,-7
                |-3,-6,2,0
                |0,0,1,3
                |-7,3,0,0
                |3,6,3,-3
                |6,-8,-1,0
                |7,-6,1,-7
                |-8,-6,-8,0
                |6,-7,5,4
                |-1,2,4,2
                |0,7,6,8
                |0,-7,4,-5
                |2,5,-6,2
                |-8,-2,4,4
                |5,1,-7,-7
                |6,2,5,-3
                |4,-5,-2,-4
                |-2,2,-5,3
                |8,0,4,8
                |2,2,-6,4
                |4,0,7,3
                |-5,-6,6,4
                |-6,0,-3,-1
                |-1,8,-1,-8
                |-7,-5,-3,-2
                |3,3,-7,-3
                |-6,4,-5,4
                |8,-1,-3,7
                |5,5,5,2
                |0,0,1,0
                |3,8,1,1
                |6,6,-8,3
                |-4,5,3,-6
                |-3,8,4,6
                |2,0,5,-4
                |3,6,-5,5
                |4,1,-8,0
                |1,1,-3,-4
                |8,-1,-8,3
                |4,-6,-6,-7
                |-1,0,-6,1
                |0,2,8,-3
                |-2,1,0,5
                |-8,2,6,3
                |-3,0,-8,7
                |-6,-5,0,-6
                |1,-7,1,-8
                |-7,-8,3,0
                |-6,4,-6,-7
                |1,-2,4,0
                |0,-3,-7,8
                |-1,0,-2,0
                |0,4,0,5
                |-2,-1,-8,2
                |1,-6,-2,-7
                |6,-5,2,8
                |-5,5,-2,-6
                |3,-2,-3,-5
                |8,2,-6,8
                |0,-5,3,7
                |8,7,-8,0
                |-3,6,-6,8
                |-6,5,7,3
                |-2,-7,-7,-6
                |-2,6,5,5
                |0,2,-5,8
                |3,-1,2,-4
                |-8,-3,5,7
                |0,3,-8,0
                |8,-6,2,4
                |8,-3,-4,-8
                |7,-6,6,-3
                |3,-7,-6,-2
                |-6,3,3,-1
                |4,0,0,5
                |-3,-7,0,-7
                |3,-4,-1,4
                |5,-3,0,1
                |5,-7,2,2
                |-4,3,1,-1
                |-3,4,-3,6
                |7,1,0,-8
                |-7,-3,-2,-8
                |4,0,4,1
                |-2,0,-4,-3
                |1,-4,0,-6
                |-7,-2,8,5
                |0,2,-5,-5
                |5,0,0,2
                |-3,0,-6,-4
                |-5,0,0,1
                |-3,3,0,-1
                |-1,-6,0,-5
                |6,-1,-5,-6
                |-8,-5,-8,0
                |0,4,5,-6
                |5,4,-8,6
                |6,-7,-2,-4
                |0,6,5,-4
                |-6,-2,-2,0
                |-2,2,-1,-5
                |1,4,0,-5
                |5,-3,2,4
                |-8,8,-3,3
                |-3,1,-4,-3
                |7,-2,2,-5
                |-6,-3,-5,5
                |7,7,0,2
                |-4,0,-2,-1
                |1,-4,3,5
                |-2,-2,7,5
                |-4,-7,-5,-4
                |-1,0,4,3
                |1,-4,-4,3
                |-6,-7,8,1
                |-2,4,5,-2
                |-5,-8,-5,5
                |8,-3,5,6
                |0,8,-4,3
                |-7,0,-5,0
                |-6,1,-6,-4
                |-4,-1,0,-8
                |3,7,-6,0
                |3,6,6,-6
                |0,3,0,1
                |1,1,8,0
                |8,-8,-5,-8
                |5,-2,5,-3
                |-4,-4,-3,-2
                |0,3,-7,-6
                |7,-8,0,1
                |-5,4,7,4
                |-4,3,-5,7
                |-4,-2,-8,-3
                |-1,-6,0,-7
                |-1,-7,7,-6
                |-1,-3,0,-2
                |-3,-5,7,5
                |-1,0,-5,0
                |-7,5,-3,-5
                |0,-5,8,1
                |8,6,-8,8
                |1,-7,4,6
                |0,0,0,-8
                |-4,7,-6,-2
                |-7,-7,-6,-4
                |1,-7,8,-3
                |4,4,-3,0
                |-8,6,0,5
                |-3,1,6,-3
                |-8,-8,8,-3
                |4,-4,-7,-8
                |6,7,2,5
                |0,8,-3,0
                |8,4,-4,-7
                |0,0,3,0
                |1,-3,-3,-4
                |-4,-6,-3,3
                |0,6,-2,-3
                |6,-6,-5,-5
                |7,6,8,-4
                |7,-1,6,-6
                |3,0,1,-6
                |7,6,-8,0
                |0,-2,4,0
                |2,1,0,-8
                |3,-5,5,-6
                |-4,-8,7,-8
                |1,-4,-3,-7
                |-4,-3,-5,-4
                |0,8,-8,4
                |3,-3,3,-7
                |0,-7,1,4
                |6,1,1,4
                |2,1,-5,4
                |-6,-8,0,3
                |7,2,-6,0
                |-4,6,0,-6
                |4,7,-8,0
                |1,-1,5,-1
                |-4,0,-7,-1
                |-7,8,4,0
                |-2,0,4,3
                |-6,0,-2,-4
                |6,-4,1,0
                |-1,5,7,5
                |8,-4,8,0
                |1,-6,0,-4
                |2,2,0,2
                |6,8,7,-5
                |-3,-5,-4,3
                |5,1,-4,-8
                |-4,-7,3,0
                |5,-6,3,5
                |-5,2,1,-5
                |3,3,-2,8
                |-1,0,7,-4
                |-3,-3,-5,0
                |-7,0,-3,-3
                |-6,-5,4,8
                |1,0,-5,2
                |-3,-8,-2,-6
                |-8,8,0,-7
                |4,-6,-8,-8
                |-7,1,1,1
                |2,0,-6,-3
                |5,6,-5,5
                |0,4,-3,6
                |0,-1,-3,-5
                |2,-3,-5,-4
                |5,-1,0,-5
                |6,-7,-4,1
                |-6,-8,8,-2
                |-8,7,-2,-2
                |8,4,-8,7
                |8,-3,-6,6
                |-4,-3,4,5
                |-2,8,4,-4
                |7,-7,3,0
                |4,-3,6,0
                |-6,-7,4,5
                |-6,4,-5,0
                |1,1,-1,0
                |-2,0,8,6
                |3,-3,5,-8
                |-6,1,-5,0
                |-4,0,1,5
                |8,-2,-3,2
                |-4,-5,7,3
                |-7,-4,5,5
                |-3,7,0,4
                |-5,0,3,3
                |-5,8,-5,4
                |6,0,-6,1
                |0,3,3,8
                |0,-3,-8,-8
                |-4,-4,3,0
                |-1,0,8,-8
                |0,-3,-1,3
                |-3,3,-3,6
                |-1,-8,-3,-1
                |4,2,-2,0
                |7,5,-4,-7
                |-4,-6,-1,7
                |7,4,8,6
                |-6,-6,3,-6
                |-6,0,8,1
                |-7,-2,0,4
                |8,-8,-4,-3
                |0,7,2,-6
                |8,5,-8,-4
                |5,3,3,3
                |3,-6,-7,2
                |6,2,0,3
                |-5,5,-4,0
                |0,-5,0,-4
                |0,-5,6,-1
                |2,2,4,-5
                |7,-3,0,7
                |0,5,-4,-5
                |-3,5,-7,-3
                |0,-2,5,2
                |-3,8,-1,-6
                |8,-8,8,-5
                |4,-2,0,-2
                |1,1,2,0
                |-7,-2,-6,-4
                |-5,1,7,6
                |0,0,-7,2
                |-7,-2,-1,-3
                |6,2,-4,1
                |-3,0,2,-3
                |0,-3,2,-1
                |3,7,-4,0
                |-1,0,1,-1
                |-6,8,-6,0
                |-4,-3,-1,4
                |5,-7,3,8
                |6,8,-3,5
                |1,2,-3,5
                |0,5,1,4
                |-4,2,3,-3
                |3,-3,-7,-4
                |8,0,0,-7
                |8,2,7,3
                |-6,-8,7,3
                |-1,0,4,-2
                |4,4,-6,6
                |5,0,-3,4
                |-5,-4,8,-8
                |0,-1,-1,0
                |6,-2,-1,4
                |-4,0,-6,-8
                |2,6,0,6
                |0,0,-2,-6
                |8,-1,-6,0
                |8,1,-6,-1
                |-4,1,6,-3
                |-5,-1,-6,-8
                |8,0,-1,2
                |3,0,7,6
                |-1,-2,5,-2
                |3,-2,7,1
                |-4,1,7,-3
                |-5,-5,6,7
                |-5,-1,7,-4
                |7,1,-3,-5
                |-8,1,2,-5
                |-4,0,-6,4
                |-3,-1,-3,4
                |-8,5,0,7
                |0,-2,8,-5
                |-3,8,4,1
                |8,2,2,4
                |-1,-3,5,-8
                |7,3,2,8
                |0,8,0,3
                |3,-4,-8,4
                |1,1,-3,-1
                |0,3,2,0
                |7,8,-1,1
                |-2,4,-6,0
                |2,4,-8,-8
                |-5,4,-3,7
                |-2,5,4,-7
                |-3,-3,0,-1
                |1,-3,-7,6
                |0,7,-4,-4
                |0,-4,-8,0
                |8,0,2,3
                |-2,-4,5,-1
                |-3,6,5,1
                |-7,-4,-5,5
                |1,2,-2,7
                |-6,3,5,-6
                |-6,-2,6,2
                |3,-7,-2,0
                |7,-7,-6,1
                |-3,0,1,-6
                |-1,-3,-7,-8
                |6,6,-6,-8
                |2,8,-5,-3
                |2,6,6,-4
                |7,0,0,-4
                |-7,-4,3,8
                |-8,4,-6,5
                |8,-7,0,-4
                |-7,8,0,-1
                |-4,8,-5,-5
                |-8,-8,-5,-4
                |0,4,5,-5
                |4,0,-7,-5
                |-2,-2,7,-4
                |-2,-8,0,-8
                |4,8,8,-6
                |4,1,-4,1
                |-8,-8,2,-1
                |5,5,4,1
                |-2,2,-8,-8
                |-4,0,6,-2
                |6,4,-6,4
                |7,-3,3,0
                |0,4,6,-4
                |1,-1,0,0
                |2,-5,2,4
                |-3,3,-4,-4
                |-3,-4,-8,-5
                |0,0,-1,5
                |-2,-8,7,-3
                |4,-2,7,-2
                |-3,6,-8,0
                |8,4,8,4
                |7,-8,1,-5
                |-3,8,2,8
                |2,6,0,-7
                |6,-8,0,0
                |2,-4,-8,6
                |-3,-1,-8,5
                |-8,-7,-7,8
                |6,4,3,-2
                |7,-5,6,-8
                |-5,2,4,8
                |5,-2,1,-5
                |6,2,-8,-8
                |-3,-6,1,0
                |-5,-8,8,2
                |3,4,-4,4
                |-1,-5,7,-3
                |-6,-8,-6,3
                |-6,-5,-2,7
                |2,-5,8,-1
                |1,6,-2,-1
                |3,-4,1,4
                |-3,-8,-5,0
                |6,4,8,5
                |-4,0,5,-2
                |2,-8,-7,-2
                |-2,8,-2,1
                |5,6,1,6
                |-5,4,-4,-8
                |-8,1,-1,7
                |7,-4,0,-1
                |2,8,8,1
                |7,4,-4,-8
                |0,-2,-5,6
                |-3,-1,-4,4
                |8,7,-7,1
                |-5,-8,-4,-8
                |-8,-3,8,-5
                |4,1,5,6
                |8,0,6,-3
                |8,-7,7,0
                |-2,7,1,-3
                |-3,-7,5,-5
                |0,-7,-2,1
                |0,3,-3,2
                |-1,1,4,6
                |-1,-4,3,-7
                |-2,2,4,6
                |-2,-7,-1,7
                |3,-7,2,-4
                |0,5,8,1
                |-2,-8,-7,-6
                |-1,8,-6,3
                |-1,4,0,-1
                |6,4,3,5
                |-3,-3,-8,-1
                |2,-1,5,-3
                |3,3,7,-6
                |3,-4,-1,0
                |0,-1,-2,-4
                |-5,4,4,2
                |-8,5,-6,-3
                |0,4,5,0
                |3,-5,-2,1
                |-8,-3,5,5
                |3,0,4,-2
                |-3,-8,4,-2
                |0,6,-7,-2
                |8,-2,6,-6
                |5,7,5,7
                |-3,-3,-6,5
                |-8,-7,-2,0
                |4,-1,-4,3
                |-5,5,-8,-6
                |2,4,5,6
                |-2,1,-6,-1
                |2,-2,5,7
                |0,-3,-3,4
                |-5,7,1,-5
                |-5,-2,0,0
                |-4,-3,0,2
                |-4,-6,0,-7
                |0,-1,6,2
                |-3,4,6,-6
                |3,-2,6,2
                |6,-4,-8,4
                |4,-2,-6,0
                |1,7,-1,3
                |0,4,8,5
                |-1,4,2,-5
                |0,-2,5,-6
                |5,6,2,-5
                |-1,-8,2,-8
                |-4,1,6,-7
                |-2,1,-5,0
                |-8,7,0,5
                |-4,-7,-3,3
                |1,-6,5,7
                |-1,3,8,3
                |-3,3,-4,-1
                |2,-7,0,0
                |-7,3,1,-1
                |8,5,-8,0
                |-4,-5,6,0
                |-6,0,8,-5
                |6,5,8,-6
                |3,-7,1,-5
                |-7,-4,6,-2
                |-6,0,6,-7
                |-4,-6,-6,-8
                |0,-6,-7,-1
                |7,-5,-1,3
                |7,-7,-1,-3
                |1,5,6,-5
                |-1,-2,1,3
                |0,5,1,7
                |8,-5,-1,7
                |7,2,0,-1
                |-1,0,7,8
                |-6,0,7,6
                |3,-3,-8,4
                |0,8,-1,8
                |-7,2,-5,5
                |3,-4,-2,7
                |1,0,4,-3
                |3,-2,2,0
                |0,2,6,-7
                |-3,-5,1,-6
                |8,-1,0,-5
                |0,-5,-5,8
                |-1,2,4,-8
                |0,-7,-8,-1
                |0,-7,-2,-6
                |-4,-4,-2,-3
                |0,0,4,3
                |-3,-3,3,0
                |-2,-6,5,-5
                |-3,7,2,-4
                |4,-6,-7,4
                |5,0,0,-5
                |4,4,-7,0
                |6,-6,-8,3
                |3,-8,-8,5
                |-2,2,-7,-2
                |8,8,0,8
                |0,6,-4,5
                |7,0,-8,-5
                |-5,3,1,1
                |-2,4,4,0
                |0,7,8,6
                |7,-1,-7,2
                |-4,0,-1,8
                |0,-3,-2,0
                |0,-6,-7,0
                |7,6,-2,-7
                |-3,-5,3,-6
                |-4,-6,4,1
                |3,6,-4,1
                |-4,-8,-7,7
                |6,0,-5,0
                |6,8,0,7
                |4,0,5,-3
                |-4,-5,1,0
                |3,5,6,3
                |-7,-5,-7,8
                |1,5,6,7
                |5,-2,1,8
                |-3,3,8,-4
                |3,-4,-6,-7
                |-3,1,-8,-3
                |1,-2,7,4
                |-6,-3,-2,3
                |2,-5,-5,-6
                |0,-8,5,-3
                |6,4,-8,0
                |0,3,6,-1
                |-3,7,-7,-6
                |-8,-6,-3,-3
                |0,-7,8,-2
                |2,-1,-3,8
                |0,-7,0,1
                |-7,5,4,6
                |3,6,-4,2
                |7,2,2,0
                |0,-3,0,4
                |1,-2,0,-1
                |0,2,-3,-1
                |1,-2,-4,4
                |3,6,-2,1
                |-8,-2,1,3
                |-1,8,-6,5
                |-4,-8,4,2
                |-7,-2,0,7
                |3,3,4,7
                |0,-1,0,8
                |-7,-5,8,5
                |3,-1,8,8
                |-6,7,-1,7
                |0,8,2,-7
                |-5,2,-5,0
                |4,-4,-5,0
                |-2,3,3,7
                |4,7,-4,0
                |7,-6,-5,-4
                |7,-2,6,-5
                |0,-8,2,3
                |0,0,0,-5
                |0,-1,-2,7
                |3,0,1,6
                |-8,-4,-2,-4
                |0,0,0,3
                |8,-6,5,0
                |-6,8,2,2
                |-5,-2,0,-1
                |7,-4,1,-5
                |8,-3,-4,-5
                |2,-5,-5,0
                |-8,-7,0,-6
                |2,-2,-4,0
                |0,-5,4,-5
                |0,2,-4,4
                |-3,-3,-2,0
                |-4,5,4,-3
                |0,0,0,2
                |-4,-3,3,-5
                |7,-6,-6,7
                |-4,-3,-5,-8
                |-3,-6,-7,-4
                |-4,-5,7,-4
                |-8,0,7,-4
                |-1,5,-1,6
                |5,7,5,6
                |-5,3,2,7
                |-6,7,-4,-5
                |8,-8,-4,4
                |8,3,-1,-3
                |-1,0,4,-5
                |0,-4,5,5
                |-2,7,5,0
                |-4,7,7,5
                |4,6,3,0
                |-4,-7,7,-3
                |-4,7,1,-6
                |0,1,-4,-8
                |-7,-4,5,-7
                |-4,0,-3,5
                |1,8,4,-8
                |0,0,6,7
                |-1,-3,-3,-7
                |-8,-3,-8,0
                |4,-2,8,6
                |0,2,-5,5
                |1,5,-6,4
                |-8,7,0,7
                |8,-1,-8,-6
                |0,3,-3,-8
                |-5,6,3,-7
                |6,4,5,6
                |-5,3,4,-2
                |-5,0,-2,0
                |4,7,8,6
                |2,-8,-5,8
                |1,3,3,-3
                |3,-7,-6,7
                |1,3,5,3
                |-1,4,7,-6
                |3,-4,5,1
                |3,6,4,7
                |4,0,-7,3
                |-1,-8,7,-6
                |2,-1,-2,8
                |2,2,-5,8
                |-2,1,-1,3
                |0,-8,0,2
                |7,8,-4,6
                |3,3,2,-5
                |-7,-3,-4,6
                |3,3,-8,3
                |5,0,-7,3
                |-8,-4,0,6
                |0,1,5,-5
                |4,-5,8,-7
                |-6,-7,3,1
                |8,-6,-2,0
                |8,-3,-5,4
                |0,2,-5,0
                |4,2,-1,0
                |2,8,-4,5
                |0,-1,7,-2
                |7,-5,-4,0
                |-1,-5,5,5
                |5,-6,2,-4
                |-2,-7,5,2
                |-1,-3,5,2
                |-1,0,4,-1
                |-8,2,-6,3
                |-3,0,4,1
                |0,0,4,-3
                |2,-7,-5,0
                |-5,1,7,8
                |2,0,-4,-8
                |2,7,1,6
                |3,0,3,5
                |0,-7,-3,6
                |1,4,-1,7
                |4,-3,6,-3
                |-6,5,0,7
                |-6,3,-8,1
                |-4,-4,-1,4
                |-4,-4,2,3
                |6,-1,-8,1
                |3,5,-6,1
                |0,2,-2,6
                |1,-8,3,-6
                |-6,5,8,-1
                |-6,7,2,0
                |-4,-2,6,6
                |4,2,-5,3
                |1,6,6,7
                |5,-1,-8,7
                |6,-1,1,-5
                |7,3,-3,-4
                |-7,-2,0,8
                |3,2,0,8
                |8,4,0,6
                |7,0,4,-4
                |-3,-8,8,2
                |1,-2,2,-8
                |-6,-6,-5,-5
                |-8,6,6,-7
                |3,-6,2,-6
                |-8,6,5,1
                |3,-3,3,-3
                |2,-7,5,-5
                |0,2,2,7
                |4,-2,5,5
                |8,4,7,-2
                |-7,-7,-8,-7
                |5,0,-7,-8
                |1,8,6,-8
                |-5,5,2,6
                |4,5,7,-2
                |-2,-2,8,7
                |0,-3,-8,8
                |3,7,2,-4
                |-5,1,0,6
                |0,6,-2,-7
                |-8,4,-5,2
                |-7,6,-8,3
                |6,6,-8,-4
                |3,7,-8,-3
                |-7,-6,-1,-5
                |-5,6,-6,0
                |-2,5,6,4
                |-8,-5,1,-4
                |8,1,4,-2
                |0,2,-4,1
                |-6,0,2,-5
                |-4,-4,1,6
                |-1,-3,-5,7
                |3,4,6,2
                |-8,0,-2,-5
                |8,0,8,0
                |1,-1,-1,-3
                |-7,0,2,4
                |-8,1,4,0
                |0,8,1,-3
                |8,8,0,7
                |8,-1,8,5
                |0,1,8,-2
                |6,8,0,1
                |6,-1,-5,-8
                |3,-4,-3,5
                |-1,-2,3,4
                |-4,-8,3,5
                |5,4,-2,-4
                |3,0,-5,2
                |-7,3,4,8
                |1,0,-8,7
                |-2,0,4,-6
                |-3,4,-3,0
                |-6,-6,-3,3
                |-2,2,0,6
                |2,4,-2,-6
                |-7,0,-8,-4
                |-8,-3,7,-6
                |7,6,4,-7
                |-8,0,0,-7
                |-1,1,-5,0
                |5,6,-2,3
                |-6,0,0,3
                |-3,-6,5,-2
                |-4,1,2,-6
                |-3,-1,-3,8
                |1,2,4,-1
                |-7,8,0,5
                |-8,2,-1,-5
                |-4,-7,-8,-1
                |-8,-4,0,-2
                |4,-5,-3,6
                |0,-7,2,-7
                |0,6,-8,-7
                |-4,7,-6,7
                |-7,0,-3,-6
                |6,-4,-2,1
                |3,-4,4,-1
                |8,4,-7,-2
                |7,-8,2,8
                |3,1,-8,1
                |2,-4,-4,-6
                |8,-4,2,-1
                |3,-3,-2,2
                |5,-3,8,6
                |7,-2,-6,-3
                |4,3,0,-8
                |4,0,-4,8
                |6,0,-4,-5
                |-3,2,-8,4
                |5,5,-5,-1
                |-8,7,-1,1
                |1,5,-7,-4
                |-2,-7,6,4
                |0,6,0,0
                |-7,-5,-5,-6
                |4,8,0,-1
                |4,7,-6,6
                |5,-3,2,0
                |-2,-8,4,-5
                |-3,-7,-4,8
                |8,6,3,-5
                |-7,-2,8,-6
                |0,-6,-8,-5
                |-5,0,2,4
                |-3,0,6,6
                |-3,-6,4,-5
                |2,-6,0,8
                |5,-6,2,-1
                |-3,2,-1,3
                |-1,7,0,-1
                |6,4,-3,6
                |0,0,-6,-1
                |-5,-2,4,-3
                |0,-1,2,-4
                |4,4,5,-8
                |-7,1,-2,0
                |4,0,-1,6
                |2,0,0,-3
                |4,8,7,2""".stripMargin

  import math.abs
  def dist(a: Seq[Int], b: Seq[Int]) =
    a.zip(b).map { case (a, b) => abs(a - b) }.sum

  def part1(s: String) =
    s.replace(" ", "").split("\n").map(_.split(",").map(_.toInt).toSeq).
      foldLeft(Set.empty[Set[Seq[Int]]]) { (cs, p) =>
        val fcs = cs.filter(_.map(dist(_, p)).min <= 3)
        if (fcs.isEmpty) cs + Set(p)
        else cs -- fcs + (fcs.reduce((a, b) => a ++ b) + p)
      }.size

  "part1" should "satisfy the examples given" in {
    assertResult(2)(part1(""" 0,0,0,0
                            | 3,0,0,0
                            | 0,3,0,0
                            | 0,0,3,0
                            | 0,0,0,3
                            | 0,0,0,6
                            | 9,0,0,0
                            |12,0,0,0""".stripMargin))
    assertResult(4)(part1("""-1,2,2,0
                            |0,0,2,-2
                            |0,0,0,-2
                            |-1,2,0,0
                            |-2,-2,-2,2
                            |3,0,2,-1
                            |-1,3,2,2
                            |-1,0,-1,0
                            |0,2,1,-2
                            |3,0,0,0""".stripMargin))
    assertResult(3)(part1("""1,-1,0,1
                            |2,0,-1,0
                            |3,2,-1,0
                            |0,0,3,1
                            |0,0,-1,-1
                            |2,3,-2,0
                            |-2,2,0,0
                            |2,-2,0,-1
                            |1,-1,0,-1
                            |3,2,0,2""".stripMargin))
    assertResult(8)(part1("""1,-1,-1,-2
                            |-2,-2,0,1
                            |0,2,1,3
                            |-2,3,-2,1
                            |0,2,3,-2
                            |-1,-1,1,-2
                            |0,-2,-1,0
                            |-2,2,3,-1
                            |1,2,2,0
                            |-1,-2,0,-2""".stripMargin))
  }

  "part1" should "succeed" in { info(part1(input).toString) }
}
